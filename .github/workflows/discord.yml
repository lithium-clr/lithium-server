name: Discord – Custom GitHub Events

on:
  push:

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Send Discord webhook
        run: |
          # Variables
          COMMIT_AUTHOR="${{ github.actor }}"
          COMMIT_MESSAGE=$(jq -r '.head_commit.message' <<< "${{ toJSON(github.event) }}")
          COMMIT_URL=$(jq -r '.head_commit.url' <<< "${{ toJSON(github.event) }}")
          BRANCH="${{ github.ref_name }}"
          REPO="${{ github.event.repository.name }}"

          # Créer le JSON dans un fichier
          cat > payload.json <<EOF
          {
            "username": "${COMMIT_AUTHOR}",
            "avatar_url": "https://github.com/${COMMIT_AUTHOR}.png",
            "content": "[${COMMIT_AUTHOR}](https://github.com/${COMMIT_AUTHOR})\n[${COMMIT_MESSAGE}](${COMMIT_URL})\n\n• [${COMMIT_AUTHOR}](https://github.com/${COMMIT_AUTHOR}) on [${REPO}](${{ github.server_url }}/${{ github.repository }}/tree/${BRANCH}) / ${BRANCH}"
          }
          EOF

          # Envoyer le webhook
          curl -X POST "${{ secrets.DISCORD_WEBHOOK_URL }}" \
            -H "Content-Type: application/json" \
            --data @payload.json
